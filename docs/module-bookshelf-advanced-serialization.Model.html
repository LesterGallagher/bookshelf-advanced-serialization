<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Model - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-bookshelf-advanced-serialization.Model.html">Model</a><ul class='methods'><li data-type='method'><a href="module-bookshelf-advanced-serialization.Model.html#roleDeterminer">roleDeterminer</a></li><li data-type='method'><a href="module-bookshelf-advanced-serialization.Model.html#setAccessor">setAccessor</a></li><li data-type='method'><a href="module-bookshelf-advanced-serialization.Model.html#toJSON">toJSON</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-bookshelf-advanced-serialization.html">bookshelf-advanced-serialization</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Model</h1>
    

    




<section>

<header>
    
        <h2>
            <span class="ancestors"><a href="module-bookshelf-advanced-serialization.html">bookshelf-advanced-serialization</a>.</span>
        
        Model
        </h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    

    <h4 class="name" id="Model"><span class="type-signature"></span>new Model<span class="signature">(attributes, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>The usual Bookshelf model constructor, but it accepts an
<code>accessor</code> option which will be set at <code>this._accessor</code> and passed to
<code>roleDeterminer()</code> when <code>toJSON</code> is called.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>attributes</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>accessor</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last"><p>The accessor value to set</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line221">line 221</a>
    </li></ul></dd>
    

    

    

    
</dl>
















    
    </div>

    

    

    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="rolesToVisibleFields"><span class="type-signature"></span>rolesToVisibleFields<span class="type-signature"> :Object.&lt;string, Array.&lt;string>></span></h4>




<div class="description">
    <p>An object that maps a role name to the array of properties of the
model that should be visible to that role type. Reflects a whitelisting
approach to serialization, as only properties listed in the array may be
present in the serialization result. Not all properties listed in the
array will necessarily be in the serialization result, however, if
<code>contextSpecificVisibleFields</code> is also being used.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object.&lt;string, Array.&lt;string>></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line208">line 208</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="roleDeterminer"><span class="type-signature"></span>roleDeterminer<span class="signature">(accessor)</span><span class="type-signature"> &rarr; {string|Promise.&lt;string>}</span></h4>

    



<div class="description">
    <p>A function called by <code>toJSON</code> with <code>this._accessor</code> as its argument,
to determine the accessor's role.
This role is then looked up in <code>rolesToVisibleFields</code> to identify
the visible properties of the model. May return a promise--this allows
asynchronously determining the role.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>accessor</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last"><p><code>this._accessor</code></p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line195">line 195</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    <p>The role or a promise resolving
to the role.</p>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>
|

<span class="param-type">Promise.&lt;string></span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="setAccessor"><span class="type-signature"></span>setAccessor<span class="signature">(accessor)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Sets <code>this._accessor</code>. An alternative to setting the
accessor via the model constructor. Useful if you've already got a model
on which you want to set an accessor.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>accessor</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last"><p>The accessor value to set</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line156">line 156</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="toJSON"><span class="type-signature"></span>toJSON<span class="signature">(options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Promise.&lt;(Object|Array|undefined)>}</span></h4>

    



<div class="description">
    <p>The method for serializing a model / collection.</p>
<p>Note that this method mutates models, by loading relations per
<code>options.ensureRelationsLoaded</code> and by removing relations that are not
among the model's visible properties (the latter improves serialization
performance and helps to avoid infinite-looping / cycling of serialization).
Such mutating behavior is, admittedly, not obvious from the method's
name of <code>toJSON</code> alone. In using this plugin, you should therefore think of
<code>toJSON</code> not as merely converting the existing model to a serialized
form, but as <em>transforming</em> it according to the  user's specifications,
and then converting it to serialized form.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>An optional object specifying how to customize
the serialization result.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>contextSpecificVisibleFields</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>An optional object
specifying what properties of a model should be visible given the
application context in which <code>toJSON</code> is being invoked. The object should be
indexed first by table name, with values that are either (a) an array of
visible property names; or (b) an object indexed by the possible
context designations (i.e. the return values of <code>options.evaluator</code>),
with values that are an array of visible property names. This object,
potentially in combination with <code>options.evaluator</code>, is your
mechanism for preventing infinite-looping / cycling of serialization.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ensureRelationsLoaded</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>An optional object
analogous in form to <code>options.contextSpecificVisibleFields</code> but whose
values are arrays containing the relation names that it will be
ensured are loaded on a model / collection before serializing. Such
relations will be loaded on the model / collection if they are not
already present.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>evaluator</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>A function which returns the
context designation describing the context in which <code>toJSON</code> is being
called. Only required if <code>options.contextSpecificVisibleFields</code> or
<code>options.ensureRelationsLoaded</code> index lists by context designation.
May return a promise--this supports asynchronously determining the
context designation. By default, the evaluator will be called with
<code>this.tableName</code>, <code>this._accessedAsRelationChain</code>, and <code>this.id</code>
as arguments. You may optionally customize these arguments by passing
<code>options.getEvaluatorArguments</code> to the plugin.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line295">line 295</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise resolving to the plain
javascript object (array) representing the model (collection).</p>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;(Object|Array|undefined)></span>


    </dd>
</dl>

    



        
    

    

    
</article>

</section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Aug 05 2016 09:51:05 GMT-0400 (EDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>